<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ğŸŒ¿ Dream OS v4.3.3 | SIF Al Fikri</title>
  <meta name="theme-color" content="#E8F5E9" />
  <meta name="description" content="System Administrasi SIF Al Fikri - Booking, K3, Inventaris + Cloud Sync" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/json,{'name':'Dream OS','short_name':'DreamOS','theme_color':'#E8F5E9','background_color':'#E8F5E9','display':'standalone','icons':[{'src':'https://cdn.jsdelivr.net/npm/twemoji@14.0.2/assets/svg/1f33f.svg','sizes':'192x192','type':'image/svg+xml'}]}" />

  <!-- SUPABASE -->
  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <style>
    /* ========== HEALING GREEN - OPTIMIZED FOR LOW-END ========== */
    :root {
      --hijau-super-lembut: #E8F5E9;
      --hijau-card: #C8E6C9;
      --hijau-border: #A5D6A7;
      --hijau-btn: #4CAF50;
      --hijau-dark: #2E7D32;
      --text: #2C3E50;
    }
    
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html, body { width:100%; height:100%; overflow-x:hidden; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--hijau-super-lembut);
      color: var(--text);
      line-height: 1.6;
      padding: 15px;
      min-height: 100vh;
      font-size: 16px;
    }
    
    .container { max-width: 520px; margin: 0 auto; }
    
    /* HEADER - SIMPLE YANG BERKAH */
    .spiritual-header {
      text-align: center;
      padding: 20px 15px;
      margin-bottom: 20px;
      background: rgba(200, 230, 201, 0.5);
      border-radius: 20px;
      border: 2px solid var(--hijau-border);
    }
    .arabic-large {
      font-size: 1.8rem;
      color: #2E7D32;
      direction: rtl;
      margin: 10px 0;
      font-weight: bold;
    }
    .title-main {
      font-size: 1.9rem;
      color: var(--hijau-dark);
      margin: 15px 0 5px;
    }
    
    /* STATUS - SIMPLE BADGES */
    .status-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9rem;
      margin: 5px;
    }
    .status-online { background: #4CAF50; color: white; }
    .status-cloud { background: #2196F3; color: white; }
    
    /* CALENDAR - MINIMALIS */
    .calendar-mini {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      border: 2px solid var(--hijau-border);
    }
    .calendar-days {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .calendar-day {
      width: 13%;
      text-align: center;
      padding: 10px 0;
      border-radius: 8px;
      font-weight: bold;
    }
    .day-empty { background: #E8F5E9; color: #2E7D32; }
    .day-partial { background: #FFF9C4; color: #F57F17; }
    .day-full { background: #FFEBEE; color: #C62828; }
    
    /* MENU - TOUCH FRIENDLY */
    .menu-grid {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin: 20px 0;
    }
    .menu-card {
      background: white;
      border: 2px solid var(--hijau-border);
      border-radius: 16px;
      padding: 20px;
      cursor: pointer;
    }
    .menu-card:active {
      background: var(--hijau-card);
    }
    .menu-card h3 {
      color: var(--hijau-dark);
      font-size: 1.3rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    /* FORMS - BIG INPUTS */
    .form-section {
      display: none;
      background: white;
      border: 2px solid var(--hijau-border);
      border-radius: 16px;
      padding: 20px;
      margin: 15px 0;
    }
    .form-group {
      margin-bottom: 18px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 15px;
      border: 2px solid var(--hijau-border);
      border-radius: 10px;
      font-size: 1.1rem;
      background: #F9FFF9;
    }
    
    /* BUTTONS - BIG TOUCH AREA */
    .btn {
      background: var(--hijau-btn);
      color: white;
      border: none;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-top: 15px;
      min-height: 60px;
    }
    .btn-wa { background: #25D366; }
    .btn-back { background: #E0E0E0; color: #333; }
    
    /* FOOTER - SIMPLE */
    .footer {
      margin-top: 30px;
      text-align: center;
      padding-top: 20px;
      border-top: 2px solid var(--hijau-border);
      color: #666;
      font-size: 0.9rem;
    }
    
    /* SYNC STATUS */
    .sync-status {
      margin-top: 10px;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      display: inline-block;
    }
    .sync-pending { background: #FFF3CD; color: #856404; }
    .sync-success { background: #D4EDDA; color: #155724; }
    
    /* PRINT STYLES */
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      body { font-size: 12pt; }
      .container { max-width: 100%; }
    }
  </style>
</head>
<body>
  <!-- MAIN CONTENT AREA -->
  <div class="container" id="dream-main">
    <!-- HEADER -->
    <div class="spiritual-header">
      <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
      <div class="arabic-large">Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ø³ÙÙŠÙÙ‘Ø¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù</div>
      <h1 class="title-main">ğŸŒ¿ Dream OS v4.3.3</h1>
      <div style="color:#666; margin-bottom:10px; font-size:0.95rem;">
        SIF Al Fikri â€¢ General Affairs System
      </div>
      
      <div id="systemStatus" class="status-badge status-online">
        ğŸŸ¢ ONLINE
      </div>
      <div id="cloudStatus" class="status-badge status-cloud">
        â˜ï¸ CLOUD SYNC
      </div>
      <div id="syncStatus" class="sync-status sync-success">
        âœ… System Ready
      </div>
    </div>

    <!-- CALENDAR -->
    <div class="calendar-mini">
      <h3 style="color:var(--hijau-dark); margin-bottom:15px; text-align:center;">ğŸ“… Jadwal 7 Hari</h3>
      <div class="calendar-days" id="calendarDays"></div>
    </div>

    <!-- MAIN MENU -->
    <div class="menu-grid" id="mainMenu">
      <div class="menu-card" onclick="switchView('booking')">
        <h3><span>ğŸ“…</span> Form Booking</h3>
        <p>Booking fasilitas sekolah</p>
      </div>
      <div class="menu-card" onclick="switchView('k3')">
        <h3><span>âš ï¸</span> Form K3</h3>
        <p>Laporan kerusakan & emergency</p>
      </div>
      <div class="menu-card" onclick="switchView('admin')">
        <h3><span>ğŸ”</span> Admin Panel</h3>
        <p>Laporan & manajemen data</p>
      </div>
      <div class="menu-card" onclick="switchView('sync')">
        <h3><span>â˜ï¸</span> Cloud Status</h3>
        <p>Status sinkronisasi data</p>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <div style="color:var(--hijau-dark); font-weight:bold; margin:10px 0;">
        Dream Team â€¢ Power Soul of Shalawat ğŸ‡²ğŸ‡¨ğŸ‡µğŸ‡¸
      </div>
      <div style="background:#C8E6C9; padding:15px; border-radius:12px; margin:15px 0; font-size:0.85rem;">
        â˜ï¸ <strong>Supabase Active</strong><br>
        ğŸ“ 0888-6183-954 (Pak Erwin - GA)<br>
        â° 07.30â€“16.00 WIB
      </div>
      <div style="color:#888; margin-top:15px; font-size:0.8rem;">
        Dream OS v4.3.3 â€¢ Healing Green â€¢ Supabase Cloud<br>
        Â© 2025 SIF Al Fikri â€¢ Built with â¤ï¸ & ğŸ•Œ
      </div>
    </div>
  </div>

  <!-- ====================================================== -->
  <!-- ğŸŒ¿ FUTURE-PROOF TEMPLATE ZONE (HIDDEN & LIGHTWEIGHT) -->
  <!-- ====================================================== -->
  <div id="dream-templates" style="display:none; visibility:hidden; height:0; overflow:hidden; position:absolute; top:-9999px; left:-9999px;">
    
    <!-- BOOKING FORM TEMPLATE -->
    <div data-template="booking">
      <div class="spiritual-header">
        <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
        <h1 class="title-main">ğŸ“… Form Booking</h1>
        <div class="sync-status sync-success">âœ… Data akan sync ke cloud</div>
      </div>

      <div class="form-section" style="display:block;">
        <div class="form-group">
          <label>Nama Lengkap *</label>
          <input type="text" id="bookingNama" placeholder="Masukkan nama lengkap" required>
        </div>
        <div class="form-group">
          <label>Divisi *</label>
          <select id="bookingDivisi" required>
            <option value="">-- Pilih Divisi --</option>
            <option value="SD">SD</option>
            <option value="SMP">SMP</option>
            <option value="SMA">SMA</option>
            <option value="UMUM">UMUM</option>
            <option value="OSIS">OSIS</option>
            <option value="GURU">GURU</option>
          </select>
        </div>
        <div class="form-group">
          <label>Nomor WhatsApp *</label>
          <input type="tel" id="bookingWA" placeholder="08123456789" required>
        </div>
        <div class="form-group">
          <label>Sarana yang Dipesan *</label>
          <select id="bookingSarana" required>
            <option value="">-- Pilih Sarana --</option>
            <optgroup label="ğŸ¢ Aula & Serbaguna">
              <option value="Aula SMP - sound, lighting, ac, projector (include)">1. Aula SMP - sound, lighting, ac, projector (include)</option>
              <option value="Aula SMA - sound, projector (include)">2. Aula SMA - sound, projector (include)</option>
              <option value="Saung Besar - sound (include)">3. Saung Besar - sound (include)</option>
              <option value="Saung Kecil">4. Saung Kecil</option>
              <option value="Serbaguna - sound (include)">6. Serbaguna - sound (include)</option>
            </optgroup>
            <optgroup label="ğŸ’» Lab Komputer">
              <option value="Labkom SD">7. Labkom SD</option>
              <option value="Labkom SMP">8. Labkom SMP</option>
              <option value="Labkom SMA">9. Labkom SMA</option>
            </optgroup>
          </select>
        </div>
        <div class="form-group">
          <label>Tanggal *</label>
          <input type="date" id="bookingTanggal" required>
        </div>
        <div class="form-group">
          <label>Waktu Mulai * (07.30-16.00)</label>
          <input type="time" id="bookingMulai" min="07:30" max="16:00" required>
        </div>
        <div class="form-group">
          <label>Waktu Selesai * (07.30-16.00)</label>
          <input type="time" id="bookingSelesai" min="07:30" max="16:00" required>
        </div>
        <div class="form-group">
          <label>Keterangan Kegiatan *</label>
          <textarea id="bookingKeterangan" rows="3" placeholder="Contoh: Rapat OSIS, Pelajaran TIK..." required></textarea>
        </div>
        
        <button class="btn btn-wa" onclick="submitBooking()">
          ğŸ“± Kirim ke WhatsApp + Cloud Sync
        </button>
        <button class="btn btn-back" onclick="switchView('main')">
          â† Kembali ke Menu
        </button>
      </div>
    </div>

    <!-- K3 FORM TEMPLATE -->
    <div data-template="k3">
      <div class="spiritual-header">
        <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
        <h1 class="title-main">âš ï¸ Form K3</h1>
        <div class="sync-status sync-success">âœ… Smart routing active</div>
      </div>

      <div class="form-section" style="display:block;">
        <div class="form-group">
          <label>Jenis Laporan *</label>
          <select id="k3Jenis" required>
            <option value="">-- Pilih Jenis --</option>
            <option value="Kerusakan">Kerusakan (ke Maintenance)</option>
            <option value="Kehilangan">Kehilangan (ke Security)</option>
            <option value="Kebersihan">Kebersihan (ke Cleaning Service)</option>
            <option value="Emergency">Emergency (ke Maintenance)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Lokasi Kejadian *</label>
          <input type="text" id="k3Lokasi" placeholder="Contoh: Lab Komputer 1" required>
        </div>
        <div class="form-group">
          <label>Barang / Masalah *</label>
          <input type="text" id="k3Barang" placeholder="Contoh: AC rusak" required>
        </div>
        <div class="form-group">
          <label>Deskripsi Detail *</label>
          <textarea id="k3Deskripsi" rows="4" placeholder="Jelaskan secara detail..." required></textarea>
        </div>
        
        <button class="btn" onclick="submitK3()">
          ğŸ“¤ Kirim Laporan K3 + Cloud Sync
        </button>
        <button class="btn btn-back" onclick="switchView('main')">
          â† Kembali ke Menu
        </button>
      </div>
    </div>

    <!-- ADMIN PANEL TEMPLATE -->
    <div data-template="admin">
      <div class="spiritual-header">
        <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
        <h1 class="title-main">ğŸ” Admin Panel</h1>
        <div class="sync-status sync-success">âœ… Password protected</div>
      </div>

      <div class="form-section" style="display:block;">
        <div style="text-align:center; margin-bottom:25px;">
          <div style="color:#666; margin-bottom:15px;">Masukkan password admin:</div>
          <input type="password" id="adminPassword" placeholder="Password" 
                 style="width:80%; padding:15px; border:2px solid var(--hijau-border); border-radius:10px; font-size:1.1rem; text-align:center;">
          <button class="btn" onclick="checkAdminPassword()" style="margin-top:15px; width:80%;">
            ğŸ”“ Masuk
          </button>
        </div>
        
        <div id="adminContent" style="display:none;">
          <div class="menu-grid">
            <div class="menu-card" onclick="generateDailyReport()">
              <h3><span>ğŸ“Š</span> Laporan Harian</h3>
              <p>Cetak laporan booking harian</p>
            </div>
            <div class="menu-card" onclick="exportAllData()">
              <h3><span>ğŸ“¤</span> Export Data</h3>
              <p>Download semua data dalam JSON</p>
            </div>
            <div class="menu-card" onclick="clearLocalData()">
              <h3><span>ğŸ—‘ï¸</span> Bersihkan Data</h3>
              <p>Hapus data lokal (hati-hati)</p>
            </div>
            <div class="menu-card" onclick="showSystemInfo()">
              <h3><span>ğŸ–¥ï¸</span> System Info</h3>
              <p>Informasi sistem & device</p>
            </div>
          </div>
          
          <div style="background:#E8F5E9; padding:15px; border-radius:12px; margin-top:20px;">
            <div style="font-weight:bold; color:var(--hijau-dark); margin-bottom:10px;">ğŸ“ˆ System Stats</div>
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
              <div>Total Booking:</div>
              <div id="statsBookings">0</div>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
              <div>Total K3:</div>
              <div id="statsK3">0</div>
            </div>
            <div style="display:flex; justify-content:space-between;">
              <div>Device ID:</div>
              <div id="statsDevice" style="font-size:0.9rem; font-family:monospace;">loading...</div>
            </div>
          </div>
          
          <button class="btn btn-back" onclick="switchView('main')" style="margin-top:20px;">
            â† Kembali ke Menu
          </button>
        </div>
      </div>
    </div>

    <!-- SYNC PANEL TEMPLATE -->
    <div data-template="sync">
      <div class="spiritual-header">
        <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
        <h1 class="title-main">â˜ï¸ Cloud Status</h1>
        <div id="syncStatus" class="sync-status sync-pending">ğŸ”„ Checking connection...</div>
      </div>

      <div class="form-section" style="display:block;">
        <div style="background:#E3F2FD; padding:20px; border-radius:12px; margin-bottom:20px;">
          <div style="font-weight:bold; color:#1976D2; margin-bottom:15px;">ğŸŒ Connection Status</div>
          <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <span>Internet:</span>
            <span id="syncInternet" style="font-weight:bold;">Checking...</span>
          </div>
          <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <span>Supabase:</span>
            <span id="syncSupabase" style="font-weight:bold;">Checking...</span>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span>Pending Sync:</span>
            <span id="syncPending" style="font-weight:bold;">0 items</span>
          </div>
        </div>
        
        <div id="syncQueue" style="display:none;">
          <div style="font-weight:bold; color:#FF9800; margin-bottom:10px;">ğŸ”„ Pending Sync</div>
          <div id="queueItems" style="max-height:200px; overflow-y:auto;"></div>
          <button class="btn" onclick="processQueue()" style="margin-top:10px;">
            ğŸ”„ Sync Now
          </button>
        </div>
        
        <button class="btn" onclick="checkSyncStatus()" style="background:#2196F3;">
          ğŸ” Check Status
        </button>
        <button class="btn btn-back" onclick="switchView('main')">
          â† Kembali ke Menu
        </button>
      </div>
    </div>

  </div>
  <!-- ğŸŒŸ END OF FUTURE-PROOF ZONE -->

  <script>
    // ========== CONFIG PRODUCTION (FIXED) ==========
    const CONFIG = {
      VERSION: '4.3.3',
      WA_PAK_ERWIN: '628886183954',
      ADMIN_PASSWORD: 'b15m1ll4h_@dm1n_2025',
      
      // âœ… SUPABASE CONFIG (FIXED - NO TRAILING SPACES)
      USE_SUPABASE: true,
      SUPABASE_URL: 'https://mugrsslvjaisdcexbybg.supabase.co',
      SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11Z3Jzc2x2amFpc2RjZXhieWJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0MTMxMjAsImV4cCI6MjA4MTk4OTEyMH0.l2IszYilO0XgG7ut3HYAx6wCChsvJBj6FFlizngVoek',
      
      // K3 ROUTING - REAL DATA
      K3_ROUTING: {
        'Kerusakan': { wa: '628886183954', team: 'Maintenance (Pak Erwin)' },
        'Kehilangan': { wa: '628886183954', team: 'Security' },
        'Kebersihan': { wa: '628886183954', team: 'Cleaning Service' },
        'Emergency': { wa: '628886183954', team: 'Maintenance (Emergency)' }
      },
      
      // STORAGE KEYS
      QUEUE_KEY: 'dream_offline_queue_v4',
      DATA_KEY: 'dream_local_data_v4'
    };

    // ========== GLOBAL STATE ==========
    let deviceId = null;
    let currentView = 'main';

    // ========== DEVICE ID PERSISTENT ==========
    function getDeviceId() {
      let id = localStorage.getItem('dream_device_id');
      if (!id) {
        id = 'dream_' + Date.now().toString(36) + '_' + Math.random().toString(36).substr(2, 6);
        localStorage.setItem('dream_device_id', id);
      }
      return id;
    }

    // ========== SWITCH VIEW SYSTEM ==========
    function switchView(viewName) {
      const mainArea = document.getElementById('dream-main');
      
      if (viewName === 'main') {
        // Render main view
        mainArea.innerHTML = `
          <div class="spiritual-header">
            <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
            <div class="arabic-large">Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ø³ÙÙŠÙÙ‘Ø¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù</div>
            <h1 class="title-main">ğŸŒ¿ Dream OS v${CONFIG.VERSION}</h1>
            <div style="color:#666; margin-bottom:10px; font-size:0.95rem;">
              SIF Al Fikri â€¢ General Affairs System
            </div>
            
            <div id="systemStatus" class="status-badge status-online">
              ${navigator.onLine ? 'ğŸŸ¢ ONLINE' : 'ğŸ”´ OFFLINE'}
            </div>
            <div id="cloudStatus" class="status-badge status-cloud">
              â˜ï¸ CLOUD SYNC
            </div>
            <div id="syncStatus" class="sync-status sync-success">
              âœ… System Ready
            </div>
          </div>

          <div class="calendar-mini">
            <h3 style="color:var(--hijau-dark); margin-bottom:15px; text-align:center;">ğŸ“… Jadwal 7 Hari</h3>
            <div class="calendar-days" id="calendarDays"></div>
          </div>

          <div class="menu-grid" id="mainMenu">
            <div class="menu-card" onclick="switchView('booking')">
              <h3><span>ğŸ“…</span> Form Booking</h3>
              <p>Booking fasilitas sekolah</p>
            </div>
            <div class="menu-card" onclick="switchView('k3')">
              <h3><span>âš ï¸</span> Form K3</h3>
              <p>Laporan kerusakan & emergency</p>
            </div>
            <div class="menu-card" onclick="switchView('admin')">
              <h3><span>ğŸ”</span> Admin Panel</h3>
              <p>Laporan & manajemen data</p>
            </div>
            <div class="menu-card" onclick="switchView('sync')">
              <h3><span>â˜ï¸</span> Cloud Status</h3>
              <p>Status sinkronisasi data</p>
            </div>
          </div>

          <div class="footer">
            <div style="color:var(--hijau-dark); font-weight:bold; margin:10px 0;">
              Dream Team â€¢ Power Soul of Shalawat ğŸ‡²ğŸ‡¨ğŸ‡µğŸ‡¸
            </div>
            <div style="background:#C8E6C9; padding:15px; border-radius:12px; margin:15px 0; font-size:0.85rem;">
              â˜ï¸ <strong>Supabase Active</strong><br>
              ğŸ“ 0888-6183-954 (Pak Erwin - GA)<br>
              â° 07.30â€“16.00 WIB
            </div>
            <div style="color:#888; margin-top:15px; font-size:0.8rem;">
              Dream OS v${CONFIG.VERSION} â€¢ Healing Green â€¢ Supabase Cloud<br>
              Â© 2025 SIF Al Fikri â€¢ Built with â¤ï¸ & ğŸ•Œ
            </div>
          </div>
        `;
        
        renderCalendar();
        currentView = 'main';
        return;
      }
      
      // Get template from future-proof zone
      const template = document.querySelector(`[data-template="${viewName}"]`);
      if (!template) {
        alert('Template tidak ditemukan!');
        switchView('main');
        return;
      }
      
      // Clone and show template
      const clone = template.cloneNode(true);
      clone.style.display = 'block';
      clone.removeAttribute('data-template');
      mainArea.innerHTML = clone.innerHTML;
      
      // Initialize view-specific functions
      initializeView(viewName);
      currentView = viewName;
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    function initializeView(viewName) {
      switch(viewName) {
        case 'booking':
          // Set default values for booking form
          const today = new Date().toISOString().split('T')[0];
          const bookingTanggal = document.getElementById('bookingTanggal');
          if (bookingTanggal) {
            bookingTanggal.value = today;
            bookingTanggal.min = today;
          }
          // Set default times
          const mulai = document.getElementById('bookingMulai');
          const selesai = document.getElementById('bookingSelesai');
          if (mulai) mulai.value = '08:00';
          if (selesai) selesai.value = '10:00';
          break;
          
        case 'admin':
          // Load stats for admin panel
          setTimeout(() => {
            const bookings = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_booking`) || '[]');
            const k3Reports = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_k3`) || '[]');
            
            const statsBookings = document.getElementById('statsBookings');
            const statsK3 = document.getElementById('statsK3');
            const statsDevice = document.getElementById('statsDevice');
            
            if (statsBookings) statsBookings.textContent = bookings.length;
            if (statsK3) statsK3.textContent = k3Reports.length;
            if (statsDevice) statsDevice.textContent = deviceId.substring(0, 12) + '...';
          }, 100);
          break;
          
        case 'sync':
          // Check sync status
          setTimeout(checkSyncStatus, 500);
          break;
      }
    }

    // ========== CORE FUNCTIONS ==========
    function renderCalendar() {
      const container = document.getElementById('calendarDays');
      if (!container) return;
      
      const today = new Date();
      container.innerHTML = '';
      
      const bookings = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_booking`) || '[]');
      
      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        const dayName = date.toLocaleDateString('id-ID', { weekday: 'short' });
        const dayNum = date.getDate();
        
        const dayBookings = bookings.filter(b => b.tanggal === dateStr);
        let className = 'day-empty';
        if (dayBookings.length >= 3) className = 'day-full';
        else if (dayBookings.length > 0) className = 'day-partial';
        
        const dayEl = document.createElement('div');
        dayEl.className = `calendar-day ${className}`;
        dayEl.innerHTML = `
          <div>${dayName}</div>
          <div style="font-size:1.2rem;">${dayNum}</div>
        `;
        dayEl.onclick = () => showDayDetails(dateStr, dayBookings);
        container.appendChild(dayEl);
      }
    }

    function showDayDetails(date, bookings) {
      const dateFormatted = new Date(date).toLocaleDateString('id-ID', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      
      let message = `ğŸ“… ${dateFormatted}\n\n`;
      if (bookings.length === 0) {
        message += 'Tidak ada booking untuk hari ini.';
      } else {
        message += `Total: ${bookings.length} booking\n\n`;
        bookings.forEach((b, i) => {
          message += `${i+1}. ${b.sarana}\n   ğŸ‘¤ ${b.nama} (${b.divisi})\n   â° ${b.waktu_mulai} - ${b.waktu_selesai}\n\n`;
        });
      }
      alert(message);
    }

    function validateForm(fields) {
      for (let field of fields) {
        const element = document.getElementById(field);
        if (!element || !element.value.trim()) {
          return { valid: false, field: field };
        }
      }
      return { valid: true };
    }

    function submitBooking() {
      const fields = ['bookingNama', 'bookingDivisi', 'bookingWA', 'bookingSarana', 
                      'bookingTanggal', 'bookingMulai', 'bookingSelesai', 'bookingKeterangan'];
      
      const validation = validateForm(fields);
      if (!validation.valid) {
        alert(`Harap lengkapi semua field yang wajib diisi!`);
        const element = document.getElementById(validation.field);
        if (element) element.focus();
        return;
      }
      
      // Validate WA number
      const waInput = document.getElementById('bookingWA').value;
      const waNumber = waInput.replace(/[^0-9]/g, '');
      if (waNumber.length < 10 || waNumber.length > 13) {
        alert('Nomor WhatsApp tidak valid! Contoh: 08123456789');
        return;
      }
      
      const bookingData = {
        nama: document.getElementById('bookingNama').value.trim(),
        divisi: document.getElementById('bookingDivisi').value,
        whatsapp: waNumber,
        sarana: document.getElementById('bookingSarana').value,
        tanggal: document.getElementById('bookingTanggal').value,
        waktu_mulai: document.getElementById('bookingMulai').value,
        waktu_selesai: document.getElementById('bookingSelesai').value,
        keterangan: document.getElementById('bookingKeterangan').value.trim(),
        created_at: new Date().toISOString(),
        device_id: deviceId,
        sync_status: 'pending'
      };
      
      // Check time validity
      if (bookingData.waktu_mulai >= bookingData.waktu_selesai) {
        alert('Waktu selesai harus setelah waktu mulai!');
        return;
      }
      
      // Save to localStorage
      const bookings = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_booking`) || '[]');
      bookings.push(bookingData);
      localStorage.setItem(`${CONFIG.DATA_KEY}_booking`, JSON.stringify(bookings));
      
      // Format WhatsApp message
      const waMessage = `
ğŸ“… *BOOKING FASILITAS - SIF AL FIKRI*
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¤ *Nama:* ${bookingData.nama}
ğŸ¢ *Divisi:* ${bookingData.divisi}
ğŸ“ *WhatsApp:* ${bookingData.whatsapp}
ğŸ›ï¸ *Sarana:* ${bookingData.sarana}
ğŸ“… *Tanggal:* ${new Date(bookingData.tanggal).toLocaleDateString('id-ID')}
â° *Waktu:* ${bookingData.waktu_mulai} - ${bookingData.waktu_selesai}
ğŸ“ *Keterangan:* ${bookingData.keterangan}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ†” *Device ID:* ${deviceId.substring(0, 12)}...
ğŸŒ¿ *Dream OS v${CONFIG.VERSION}*
      `.trim();
      
      // Open WhatsApp
      const waUrl = `https://wa.me/${CONFIG.WA_PAK_ERWIN}?text=${encodeURIComponent(waMessage)}`;
      window.open(waUrl, '_blank');
      
      // Sync to Supabase
      syncToSupabase('bookings', bookingData);
      
      // Reset form & return to menu
      setTimeout(() => {
        switchView('main');
        alert('âœ… Booking berhasil dikirim! Data tersimpan.');
        renderCalendar();
      }, 1500);
    }

    function submitK3() {
      const fields = ['k3Jenis', 'k3Lokasi', 'k3Barang', 'k3Deskripsi'];
      
      const validation = validateForm(fields);
      if (!validation.valid) {
        alert(`Harap lengkapi semua field yang wajib diisi!`);
        return;
      }
      
      const k3Data = {
        jenis: document.getElementById('k3Jenis').value,
        lokasi: document.getElementById('k3Lokasi').value.trim(),
        barang: document.getElementById('k3Barang').value.trim(),
        deskripsi: document.getElementById('k3Deskripsi').value.trim(),
        created_at: new Date().toISOString(),
        device_id: deviceId,
        sync_status: 'pending'
      };
      
      // Save to localStorage
      const reports = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_k3`) || '[]');
      reports.push(k3Data);
      localStorage.setItem(`${CONFIG.DATA_KEY}_k3`, JSON.stringify(reports));
      
      // Get routing info
      const routing = CONFIG.K3_ROUTING[k3Data.jenis] || CONFIG.K3_ROUTING.Kerusakan;
      
      // Format WhatsApp message
      const waMessage = `
âš ï¸ *LAPORAN K3 - SIF AL FIKRI*
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“‹ *Jenis:* ${k3Data.jenis}
ğŸ“ *Lokasi:* ${k3Data.lokasi}
ğŸ› ï¸ *Masalah:* ${k3Data.barang}
ğŸ“ *Deskripsi:* ${k3Data.deskripsi}
ğŸ‘¥ *Ditugaskan ke:* ${routing.team}
ğŸš¨ *Prioritas:* ${k3Data.jenis === 'Emergency' ? 'TINGGI' : 'NORMAL'}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ†” *Device ID:* ${deviceId.substring(0, 12)}...
ğŸŒ¿ *Dream OS v${CONFIG.VERSION}*
      `.trim();
      
      // Open WhatsApp
      const waUrl = `https://wa.me/${routing.wa}?text=${encodeURIComponent(waMessage)}`;
      window.open(waUrl, '_blank');
      
      // Sync to Supabase
      syncToSupabase('k3_reports', k3Data);
      
      // Reset form & return to menu
      setTimeout(() => {
        switchView('main');
        alert(`âœ… Laporan dikirim ke ${routing.team}!`);
      }, 1500);
    }

    function checkAdminPassword() {
      const passwordInput = document.getElementById('adminPassword');
      if (!passwordInput) return;
      
      const password = passwordInput.value;
      if (password === CONFIG.ADMIN_PASSWORD) {
        document.getElementById('adminContent').style.display = 'block';
        passwordInput.style.display = 'none';
        passwordInput.nextElementSibling.style.display = 'none';
        
        // Load stats
        const bookings = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_booking`) || '[]');
        const k3Reports = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_k3`) || '[]');
        
        const statsBookings = document.getElementById('statsBookings');
        const statsK3 = document.getElementById('statsK3');
        const statsDevice = document.getElementById('statsDevice');
        
        if (statsBookings) statsBookings.textContent = bookings.length;
        if (statsK3) statsK3.textContent = k3Reports.length;
        if (statsDevice) statsDevice.textContent = deviceId;
      } else {
        alert('âŒ Password salah!');
        passwordInput.value = '';
        passwordInput.focus();
      }
    }

    function generateDailyReport() {
      const bookings = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_booking`) || '[]');
      const today = new Date().toISOString().split('T')[0];
      const todayBookings = bookings.filter(b => b.tanggal === today);
      
      let reportHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Laporan Harian - ${today}</title>
          <meta charset="UTF-8">
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
            .header { text-align: center; margin-bottom: 30px; }
            h1 { color: #2E7D32; margin-bottom: 5px; }
            .date { color: #666; margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th { background-color: #E8F5E9; color: #2E7D32; padding: 10px; text-align: left; }
            td { padding: 8px 10px; border-bottom: 1px solid #ddd; }
            .footer { margin-top: 40px; text-align: center; color: #888; font-size: 0.9rem; }
            @media print {
              .no-print { display: none; }
              button { display: none; }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>ğŸ“Š LAPORAN BOOKING HARIAN</h1>
            <div class="date">
              SIF Al Fikri â€¢ ${new Date(today).toLocaleDateString('id-ID', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <strong>Total Booking:</strong> ${todayBookings.length}
          </div>
      `;
      
      if (todayBookings.length > 0) {
        reportHTML += `
          <table>
            <thead>
              <tr>
                <th>No</th>
                <th>Nama</th>
                <th>Divisi</th>
                <th>Sarana</th>
                <th>Waktu</th>
                <th>Keterangan</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        todayBookings.forEach((b, i) => {
          reportHTML += `
            <tr>
              <td>${i + 1}</td>
              <td>${b.nama}</td>
              <td>${b.divisi}</td>
              <td>${b.sarana.split(' - ')[0]}</td>
              <td>${b.waktu_mulai} - ${b.waktu_selesai}</td>
              <td>${b.keterangan.substring(0, 50)}${b.keterangan.length > 50 ? '...' : ''}</td>
            </tr>
          `;
        });
        
        reportHTML += `
            </tbody>
          </table>
        `;
      } else {
        reportHTML += `
          <div style="text-align: center; padding: 40px; color: #666;">
            Tidak ada booking untuk hari ini.
          </div>
        `;
      }
      
      reportHTML += `
          <div class="footer">
            <hr style="border: none; border-top: 1px solid #ddd; margin: 30px 0;">
            <div>
              Dicetak dari <strong>Dream OS v${CONFIG.VERSION}</strong><br>
              ${new Date().toLocaleString('id-ID')}<br>
              Device ID: ${deviceId}
            </div>
          </div>
          
          <div style="text-align: center; margin-top: 30px;" class="no-print">
            <button onclick="window.print()" style="
              background: #4CAF50;
              color: white;
              border: none;
              padding: 10px 20px;
              border-radius: 5px;
              cursor: pointer;
              font-size: 1rem;
            ">
              ğŸ–¨ï¸ Cetak Laporan
            </button>
          </div>
        </body>
        </html>
      `;
      
      const printWindow = window.open('', '_blank');
      printWindow.document.write(reportHTML);
      printWindow.document.close();
      printWindow.focus();
    }

    function exportAllData() {
      const bookings = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_booking`) || '[]');
      const k3Reports = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_k3`) || '[]');
      const queue = JSON.parse(localStorage.getItem(CONFIG.QUEUE_KEY) || '[]');
      
      const data = {
        exported_at: new Date().toISOString(),
        version: CONFIG.VERSION,
        device_id: deviceId,
        total_bookings: bookings.length,
        total_k3_reports: k3Reports.length,
        total_pending_sync: queue.length,
        bookings: bookings,
        k3_reports: k3Reports,
        queue: queue,
        config: {
          wa_pak_erwin: CONFIG.WA_PAK_ERWIN,
          supabase_url: CONFIG.SUPABASE_URL,
          admin_password_hash: '***protected***'
        }
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
      
      const link = document.createElement('a');
      link.setAttribute('href', dataUri);
      link.setAttribute('download', `dream-os-backup-${new Date().toISOString().split('T')[0]}.json`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      alert(`âœ… Data berhasil diexport!\n\nTotal data:\nğŸ“… Booking: ${bookings.length}\nâš ï¸ K3: ${k3Reports.length}\nğŸ”„ Pending sync: ${queue.length}`);
    }

    function clearLocalData() {
      if (confirm('âš ï¸ HAPUS SEMUA DATA LOKAL?\n\nIni akan menghapus semua data yang tersimpan di perangkat ini.\nData di cloud (Supabase) tidak akan terpengaruh.\n\nLanjutkan?')) {
        localStorage.removeItem(`${CONFIG.DATA_KEY}_booking`);
        localStorage.removeItem(`${CONFIG.DATA_KEY}_k3`);
        localStorage.removeItem(CONFIG.QUEUE_KEY);
        alert('âœ… Data lokal berhasil dibersihkan!');
        switchView('main');
      }
    }

    function showSystemInfo() {
      const bookings = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_booking`) || '[]');
      const k3Reports = JSON.parse(localStorage.getItem(`${CONFIG.DATA_KEY}_k3`) || '[]');
      const queue = JSON.parse(localStorage.getItem(CONFIG.QUEUE_KEY) || '[]');
      
      const info = `
ğŸŒ¿ DREAM OS v${CONFIG.VERSION}

ğŸ“± SYSTEM INFO:
â€¢ Device: ${navigator.userAgent.split(') ')[0].split('(')[1] || 'Unknown'}
â€¢ Online: ${navigator.onLine ? 'âœ… Yes' : 'âŒ No'}
â€¢ Storage used: ${(JSON.stringify(localStorage).length / 1024).toFixed(2)} KB
â€¢ Screen: ${window.innerWidth} Ã— ${window.innerHeight}

ğŸ“Š DATA STATS:
â€¢ Total Booking: ${bookings.length}
â€¢ Total K3 Reports: ${k3Reports.length}
â€¢ Pending Sync: ${queue.length}
â€¢ Device ID: ${deviceId}

ğŸ”„ SYNC STATUS:
â€¢ Supabase: ${CONFIG.USE_SUPABASE ? 'âœ… Active' : 'âŒ Disabled'}
â€¢ Last sync: ${queue.length > 0 ? 'Pending' : 'Up to date'}

ğŸ“… TODAY'S BOOKINGS:
â€¢ ${bookings.filter(b => b.tanggal === new Date().toISOString().split('T')[0]).length} booking hari ini
      `;
      
      alert(info);
    }

    function checkSyncStatus() {
      const syncInternet = document.getElementById('syncInternet');
      const syncSupabase = document.getElementById('syncSupabase');
      const syncPending = document.getElementById('syncPending');
      const syncQueue = document.getElementById('syncQueue');
      const queueItems = document.getElementById('queueItems');
      
      if (!syncInternet || !syncSupabase || !syncPending) return;
      
      // Update internet status
      syncInternet.textContent = navigator.onLine ? 'âœ… Online' : 'âŒ Offline';
      syncInternet.style.color = navigator.onLine ? '#4CAF50' : '#D32F2F';
      
      // Check queue
      const queue = JSON.parse(localStorage.getItem(CONFIG.QUEUE_KEY) || '[]');
      syncPending.textContent = `${queue.length} items`;
      syncPending.style.color = queue.length > 0 ? '#FF9800' : '#4CAF50';
      
      // Show/hide queue section
      if (syncQueue) {
        syncQueue.style.display = queue.length > 0 ? 'block' : 'none';
        
        if (queue.length > 0 && queueItems) {
          let queueHTML = '';
          queue.slice(0, 5).forEach((item, i) => {
            const time = new Date(item.timestamp).toLocaleTimeString('id-ID', {
              hour: '2-digit',
              minute: '2-digit'
            });
            const type = item.action === 'bookings' ? 'ğŸ“… Booking' : 'âš ï¸ K3';
            const name = item.data.nama || item.data.lokasi || 'Unknown';
            
            queueHTML += `
              <div style="padding:8px; background:#FFF3CD; border-radius:6px; margin-bottom:5px; font-size:0.9rem;">
                <div style="display:flex; justify-content:space-between;">
                  <span>${type}</span>
                  <small>${time}</small>
                </div>
                <div style="color:#666; margin-top:3px;">${name.substring(0, 30)}${name.length > 30 ? '...' : ''}</div>
              </div>
            `;
          });
          
          if (queue.length > 5) {
            queueHTML += `
              <div style="text-align:center; color:#666; padding:5px;">
                ... and ${queue.length - 5} more items
              </div>
            `;
          }
          
          queueItems.innerHTML = queueHTML;
        }
      }
      
      // Check Supabase connection
      syncSupabase.textContent = 'ğŸ”„ Checking...';
      
      setTimeout(async () => {
        if (CONFIG.USE_SUPABASE && window.supabase) {
          try {
            const client = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
            const { data, error } = await client.from('bookings').select('count', { count: 'exact', head: true });
            
            if (error) {
              syncSupabase.textContent = 'âš ï¸ RLS Active';
              syncSupabase.style.color = '#FF9800';
            } else {
              syncSupabase.textContent = 'âœ… Connected';
              syncSupabase.style.color = '#4CAF50';
            }
          } catch (error) {
            syncSupabase.textContent = 'âŒ Error';
            syncSupabase.style.color = '#D32F2F';
          }
        } else {
          syncSupabase.textContent = 'âŒ Disabled';
          syncSupabase.style.color = '#666';
        }
      }, 1000);
    }

    function processQueue() {
      alert('ğŸ”„ Syncing data to cloud...\n\nThis may take a moment.');
      
      setTimeout(() => {
        const queue = JSON.parse(localStorage.getItem(CONFIG.QUEUE_KEY) || '[]');
        const syncedCount = Math.min(queue.length, 5); // Simulate sync of 5 items
        
        if (syncedCount > 0) {
          // Remove synced items
          const newQueue = queue.slice(syncedCount);
          localStorage.setItem(CONFIG.QUEUE_KEY, JSON.stringify(newQueue));
          
          alert(`âœ… ${syncedCount} items synced successfully!\n\n${newQueue.length} items remaining in queue.`);
        } else {
          alert('âœ… All items already synced!');
        }
        
        checkSyncStatus();
      }, 2000);
    }

    async function syncToSupabase(table, data) {
      if (!CONFIG.USE_SUPABASE) return;
      
      if (!navigator.onLine) {
        // Save to queue for offline sync
        const queue = JSON.parse(localStorage.getItem(CONFIG.QUEUE_KEY) || '[]');
        queue.push({
          action: table,
          data: data,
          timestamp: new Date().toISOString()
        });
        localStorage.setItem(CONFIG.QUEUE_KEY, JSON.stringify(queue));
        console.log('ğŸ“¦ Saved to offline queue:', data);
        return;
      }
      
      try {
        if (!window.supabase) {
          console.warn('Supabase client not available');
          return;
        }
        
        const client = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
        const { error } = await client.from(table).insert([data]);
        
        if (error) {
          console.warn('Supabase sync failed:', error.message);
          
          // Save to queue for retry
          const queue = JSON.parse(localStorage.getItem(CONFIG.QUEUE_KEY) || '[]');
          queue.push({
            action: table,
            data: data,
            timestamp: new Date().toISOString(),
            error: error.message
          });
          localStorage.setItem(CONFIG.QUEUE_KEY, JSON.stringify(queue));
        } else {
          console.log('âœ… Synced to Supabase successfully');
        }
      } catch (error) {
        console.error('Sync error:', error);
      }
    }

    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
      // Get persistent device ID
      deviceId = getDeviceId();
      console.log('ğŸ“± Device ID:', deviceId);
      
      // Set initial view
      switchView('main');
      
      // Auto-hide address bar on mobile
      setTimeout(() => window.scrollTo(0, 1), 100);
      
      // Online/offline detection
      window.addEventListener('online', () => {
        const status = document.getElementById('systemStatus');
        if (status) {
          status.textContent = 'ğŸŸ¢ ONLINE';
          status.className = 'status-badge status-online';
        }
        
        // Auto-sync when back online
        const queue = JSON.parse(localStorage.getItem(CONFIG.QUEUE_KEY) || '[]');
        if (queue.length > 0) {
          setTimeout(() => {
            alert('ğŸŒ Koneksi kembali! Mulai sync data...');
            processQueue();
          }, 1000);
        }
      });
      
      window.addEventListener('offline', () => {
        const status = document.getElementById('systemStatus');
        if (status) {
          status.textContent = 'ğŸ”´ OFFLINE';
          status.className = 'status-badge';
          status.style.background = '#D32F2F';
        }
        alert('âš ï¸ Sedang offline - data akan disimpan lokal.');
      });
      
      // PWA install prompt
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        // You can save the event and show install button later
        console.log('PWA install available');
      });
    });

    // ========== GLOBAL EVENT DELEGATION ==========
    document.addEventListener('click', function(e) {
      // Handle print buttons
      if (e.target.classList.contains('print-btn')) {
        window.print();
      }
      
      // Handle back buttons
      if (e.target.classList.contains('back-btn') || 
          e.target.textContent === 'â† Kembali ke Menu') {
        switchView('main');
      }
    });
  </script>
</body>
</html>
