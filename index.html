<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ğŸŒ¿ Dream OS v4.3.3 | SIF Al Fikri</title>
  <meta name="theme-color" content="#EAF7ED">
  <meta name="description" content="System Administrasi SIF Al Fikri - Booking 19 Sarana, K3, Inventaris + Cloud Sync">

  <style>
    /* ========== HEALING GREEN PREMIUM PALETTE ========== */
    :root {
      --bg-main: #F8FCF6;
      --bg-card: #EAF7ED;
      --accent: #4CAF50;
      --accent-hover: #45A049;
      --text-dark: #2E7D32;
      --border-soft: #C8E6C9;
      --shadow-soft: rgba(0,0,0,0.05);
      --shadow-hover: rgba(0,0,0,0.08);
      --danger: #f44336;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg-main);
      color: var(--text-dark);
      line-height: 1.6;
      padding: 16px;
      max-width: 520px;
      margin: 0 auto;
      min-height: 100vh;
    }

    .header-gradient {
      background: linear-gradient(135deg, #EAF7ED 0%, #F8FCF6 100%);
      padding: 24px 20px;
      border-radius: 20px;
      text-align: center;
      margin-bottom: 20px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 4px 12px var(--shadow-soft);
    }

    .arabic-large {
      font-size: 1.8rem;
      color: var(--text-dark);
      direction: rtl;
      margin: 8px 0;
      font-weight: bold;
      opacity: 0.9;
    }

    .title-main {
      font-size: 1.8rem;
      color: var(--text-dark);
      margin: 12px 0 6px;
      font-weight: 700;
    }

    .subtitle {
      color: #666;
      font-size: 0.95rem;
      margin-bottom: 15px;
    }

    .badge-container {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 24px;
      font-size: 0.85rem;
      font-weight: 600;
      background: white;
      border: 1px solid var(--border-soft);
      box-shadow: 0 2px 6px var(--shadow-soft);
    }

    .card {
      background: var(--bg-card);
      border-radius: 18px;
      padding: 20px;
      box-shadow: 0 4px 12px var(--shadow-soft);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid var(--border-soft);
      cursor: pointer;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px var(--shadow-hover);
    }

    .card-icon {
      font-size: 1.8rem;
      margin-bottom: 12px;
      display: inline-block;
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 8px;
    }

    .card-desc {
      color: #666;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 24px;
      border-radius: 14px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      text-decoration: none;
      width: 100%;
      margin-top: 10px;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.25);
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(76, 175, 80, 0.35);
    }

    .btn-secondary {
      background: white;
      color: var(--text-dark);
      border: 1px solid var(--border-soft);
    }

    .btn-secondary:hover {
      background: var(--bg-card);
      transform: translateY(-2px);
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 0.9rem;
      width: auto;
      margin: 2px;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      color: var(--text-dark);
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 14px 16px;
      border: 1.5px solid var(--border-soft);
      border-radius: 12px;
      font-size: 1rem;
      background: white;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .tab-container {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      background: white;
      padding: 8px;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
    }

    .tab-button {
      flex: 1;
      padding: 12px;
      border: none;
      background: transparent;
      color: var(--text-dark);
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tab-button.active {
      background: var(--accent);
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      background: white;
      margin-top: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th {
      background: var(--accent);
      color: white;
      text-align: left;
      padding: 12px;
      font-weight: 600;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid var(--border-soft);
      vertical-align: top;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover {
      background: var(--bg-card);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-good { background: #E8F5E9; color: #2E7D32; }
    .status-warning { background: #FFF3CD; color: #856404; }
    .status-danger { background: #F8D7DA; color: #721C24; }

    .text-center { text-align: center; }
    .mt-2 { margin-top: 16px; }
    .hidden { display: none !important; }
    .form-slot { display: none; }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 16px;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    @media (max-width: 480px) {
      body { padding: 12px; }
      .header-gradient { padding: 20px 16px; }
      .card { padding: 16px; }
      .btn { padding: 12px 20px; }
      th, td { padding: 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <div class="header-gradient">
      <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
      <div class="arabic-large">Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ø³ÙÙŠÙÙ‘Ø¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù</div>
      
      <h1 class="title-main">ğŸŒ¿ Dream OS v4.3.3</h1>
      <div class="subtitle">SIF Al Fikri â€¢ 19 Sarana â€¢ Smart Inventory</div>
      
      <div class="badge-container">
        <div class="badge online">ğŸŸ¢ ONLINE</div>
        <div class="badge cloud">â˜ï¸ SMART INVENTORY</div>
      </div>
    </div>

    <!-- MAIN MENU -->
    <div class="card" onclick="switchView('booking')">
      <div class="card-icon">ğŸ“</div>
      <h3 class="card-title">Form Booking</h3>
      <p class="card-desc">Booking 19 sarana lengkap dengan validasi otomatis</p>
    </div>

    <div class="card" onclick="switchView('k3')">
      <div class="card-icon">âš ï¸</div>
      <h3 class="card-title">Form K3</h3>
      <p class="card-desc">Laporan kerusakan + kamera ke Pak Erwin</p>
    </div>

    <div class="card" onclick="switchView('admin')">
      <div class="card-icon">ğŸ”</div>
      <h3 class="card-title">Admin Panel</h3>
      <p class="card-desc">Login email: <strong>teknisi@alfikri.sch.id</strong></p>
    </div>

    <!-- PARTIAL SLOTS -->
    <div id="slot-booking" class="form-slot"></div>
    <div id="slot-k3" class="form-slot"></div>
    <div id="slot-admin" class="form-slot"></div>

    <!-- FOOTER -->
    <div class="text-center" style="color: #666; margin-top: 30px; font-size: 0.85rem;">
      <div style="color: var(--text-dark); font-weight: 600; margin-bottom: 8px;">
        Dream Team â€¢ The Power Soul of Shalawat
      </div>
      Â© 2025 SIF Al Fikri â€¢ Smart Inventory â€¢ Built with â¤ï¸ & ğŸ•Œ<br>
      ğŸ‡²ğŸ‡¨ğŸ‡µğŸ‡¸
    </div>
  </div>

  <!-- PARTIAL: BOOKING -->
  <template id="partial-booking">
    <div class="header-gradient">
      <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
      <h1 class="title-main">ğŸ“… Form Booking</h1>
    </div>
    <div class="card">
      <form id="bookingForm" onsubmit="event.preventDefault(); submitBooking();">
        <div class="form-group">
          <label class="form-label">Nama Lengkap *</label>
          <input type="text" class="form-input" id="bookingNama" required>
        </div>
        <div class="form-group">
          <label class="form-label">Divisi *</label>
          <select class="form-select" id="bookingDivisi" required>
            <option value="">-- Pilih Divisi --</option>
            <option value="SD">SD</option>
            <option value="SMP">SMP</option>
            <option value="SMA">SMA</option>
            <option value="UMUM">UMUM</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">WhatsApp *</label>
          <input type="tel" class="form-input" id="bookingWA" placeholder="08123456789" required>
        </div>
        <div class="form-group">
          <label class="form-label">Sarana *</label>
          <select class="form-select" id="bookingSarana" required>
            <option value="">-- Pilih Sarana --</option>
            <optgroup label="ğŸ¢ Aula & Serbaguna">
              <option value="Aula SMP - sound, lighting, ac, projector (include)">1. Aula SMP - sound, lighting, ac, projector (include)</option>
              <option value="Aula SMA - sound, projector (include)">2. Aula SMA - sound, projector (include)</option>
              <option value="Saung Besar - sound (include)">3. Saung Besar - sound (include)</option>
              <option value="Saung Kecil">4. Saung Kecil</option>
              <option value="Serbaguna - sound (include)">5. Serbaguna - sound (include)</option>
            </optgroup>
            <optgroup label="ğŸ’» Lab Komputer">
              <option value="Labkom SD">6. Labkom SD</option>
              <option value="Labkom SMP">7. Labkom SMP</option>
              <option value="Labkom SMA">8. Labkom SMA</option>
            </optgroup>
            <optgroup label="âš½ Lapangan Olahraga">
              <option value="Lapangan Basket">9. Lapangan Basket</option>
              <option value="Lapangan Futsal">10. Lapangan Futsal</option>
              <option value="Lapangan Voli">11. Lapangan Voli</option>
              <option value="Lapangan SMA">12. Lapangan SMA</option>
              <option value="Lapangan Depan Masjid">13. Lapangan Depan Masjid</option>
            </optgroup>
            <optgroup label="ğŸ“š Perpustakaan">
              <option value="Perpustakaan SD">14. Perpustakaan SD</option>
              <option value="Perpustakaan SMP">15. Perpustakaan SMP</option>
              <option value="Perpustakaan SMA">16. Perpustakaan SMA</option>
            </optgroup>
            <optgroup label="ğŸ•Œ Ruang Khusus">
              <option value="Masjid">17. Masjid</option>
              <option value="Kantin SMP">18. Kantin SMP</option>
              <option value="Kantin SMA">19. Kantin SMA</option>
            </optgroup>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Tanggal *</label>
          <input type="date" class="form-input" id="bookingTanggal" required>
        </div>
        <div class="form-group">
          <label class="form-label">Waktu Mulai *</label>
          <input type="time" class="form-input" id="bookingMulai" min="07:30" max="16:00" required>
        </div>
        <div class="form-group">
          <label class="form-label">Waktu Selesai *</label>
          <input type="time" class="form-input" id="bookingSelesai" min="07:30" max="16:00" required>
        </div>
        <div class="form-group">
          <label class="form-label">Keterangan *</label>
          <textarea class="form-textarea" id="bookingKeterangan" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">ğŸ“± Kirim ke WhatsApp</button>
        <button class="btn btn-secondary" onclick="switchView('main')">â† Kembali</button>
      </form>
    </div>
  </template>

  <!-- PARTIAL: K3 -->
  <template id="partial-k3">
    <div class="header-gradient">
      <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
      <h1 class="title-main">âš ï¸ Form K3</h1>
    </div>
    <div class="card">
      <form id="k3Form" onsubmit="event.preventDefault(); submitK3();">
        <div class="form-group">
          <label class="form-label">Jenis Laporan *</label>
          <select class="form-select" id="k3Jenis" required>
            <option value="">-- Pilih Jenis --</option>
            <option value="Kerusakan">Kerusakan (ke Maintenance)</option>
            <option value="Kehilangan">Kehilangan (ke Security)</option>
            <option value="Kebersihan">Kebersihan (ke Cleaning Service)</option>
            <option value="Emergency">Emergency (ke Maintenance)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Lokasi *</label>
          <input type="text" class="form-input" id="k3Lokasi" required>
        </div>
        <div class="form-group">
          <label class="form-label">Barang/Masalah *</label>
          <input type="text" class="form-input" id="k3Barang" required>
        </div>
        <div class="form-group">
          <label class="form-label">Deskripsi *</label>
          <textarea class="form-textarea" id="k3Deskripsi" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">ğŸ“¤ Kirim ke Pak Erwin</button>
        <button class="btn btn-secondary" onclick="switchView('main')">â† Kembali</button>
      </form>
    </div>
  </template>

  <!-- PARTIAL: ADMIN -->
  <template id="partial-admin">
    <div class="header-gradient">
      <div class="arabic-large">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
      <h1 class="title-main">ğŸ” Admin Panel</h1>
    </div>
    <div class="card">
      <div id="adminLoginForm">
        <div class="form-group">
          <label class="form-label">Email Admin</label>
          <input type="email" class="form-input" id="adminEmail" placeholder="teknisi@alfikri.sch.id">
        </div>
        <button class="btn btn-primary" onclick="loginAdmin()">Login</button>
        <button class="btn btn-secondary" onclick="switchView('main')">â† Kembali</button>
      </div>
      <div id="adminContent" class="hidden">
        <div class="tab-container">
          <button class="tab-button active" data-tab="dashboard">ğŸ“Š Dashboard</button>
          <button class="tab-button" data-tab="inventaris">ğŸ“¦ Inventaris</button>
        </div>
        <div id="dashboard-tab" class="tab-content active">
          <h3 class="card-title">Dashboard Admin</h3>
          <div class="card" style="background: white; margin-top: 16px;">
            <h4>ğŸ“ˆ Statistik</h4>
            <div style="display: flex; justify-content: space-between; margin-top: 12px;">
              <div>Booking:</div><div id="statsBookingCount">0</div>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <div>K3:</div><div id="statsK3Count">0</div>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <div>Inventaris:</div><div id="statsInventarisCount">0</div>
            </div>
          </div>
          <button class="btn btn-primary mt-2" onclick="exportData()">ğŸ“¥ Export Semua</button>
        </div>
        <div id="inventaris-tab" class="tab-content">
          <h3 class="card-title">ğŸ“¦ Smart Inventory</h3>
          <button class="btn btn-primary" onclick="showAddItemModal()">â• Tambah Barang</button>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Kode</th><th>Nama</th><th>Kategori</th><th>Jumlah</th><th>Kondisi</th><th>Lokasi</th><th>Aksi</th>
                </tr>
              </thead>
              <tbody id="inventaris-table-body"></tbody>
            </table>
            <div id="inventaris-empty" class="text-center" style="padding: 40px; color: #666; display: none;">
              ğŸ“¦ Belum ada data inventaris.
            </div>
          </div>
        </div>
        <button class="btn btn-secondary mt-2" onclick="logoutAdmin()">Logout</button>
      </div>
    </div>
  </template>

  <!-- MODAL TAMBAH INVENTARIS -->
  <div id="addItemModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="card-title">â• Tambah Barang</h3>
      <div class="form-group">
        <input type="text" class="form-input" id="invKode" placeholder="Kode (INV-001)" required>
      </div>
      <div class="form-group">
        <input type="text" class="form-input" id="invNama" placeholder="Nama Barang" required>
      </div>
      <div class="form-group">
        <select class="form-select" id="invKategori" required>
          <option value="">-- Kategori --</option>
          <option value="Elektronik">Elektronik</option>
          <option value="Furnitur">Furnitur</option>
          <option value="Alat Kebersihan">Alat Kebersihan</option>
          <option value="ATK">ATK</option>
          <option value="Olahraga">Olahraga</option>
          <option value="Lainnya">Lainnya</option>
        </select>
      </div>
      <div class="form-group">
        <input type="number" class="form-input" id="invJumlah" value="1" min="1" required>
      </div>
      <div class="form-group">
        <select class="form-select" id="invKondisi" required>
          <option value="Baik">âœ… Baik</option>
          <option value="Rusak">âš ï¸ Rusak</option>
          <option value="Perlu Perbaikan">ğŸ”§ Perlu Perbaikan</option>
        </select>
      </div>
      <div class="form-group">
        <input type="text" class="form-input" id="invLokasi" placeholder="Lokasi" required>
      </div>
      <div class="form-group">
        <input type="date" class="form-input" id="invTanggal" required>
      </div>
      <div class="form-group">
        <textarea class="form-textarea" id="invKeterangan" placeholder="Keterangan (opsional)"></textarea>
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="btn btn-primary" onclick="saveInventarisItem()">âœ… Simpan</button>
        <button class="btn btn-secondary" onclick="hideAddItemModal()">Batal</button>
      </div>
    </div>
  </div>

  <script>
    console.log(`
ğŸŒ¿ DREAM OS v4.3.3 - DEPLOYMENT DOA
====================================
Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù
Allahumma barik lana fi amrina hadza...
====================================
`);

    const CONFIG = {
      ADMIN_EMAIL: 'teknisi@alfikri.sch.id',
      WA_PAK_ERWIN: '628886183954',
      STORAGE_KEYS: {
        BOOKINGS: 'dream_bookings',
        K3_REPORTS: 'dream_k3_reports',
        INVENTARIS: 'dream_inventaris',
        ADMIN_SESSION: 'dream_admin_session'
      }
    };

    // ========== VIEW SYSTEM ==========
    function switchView(view) {
      ['slot-booking', 'slot-k3', 'slot-admin'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
      document.querySelectorAll('.card[onclick^="switchView"]').forEach(card => {
        card.style.display = view === 'main' ? 'block' : 'none';
      });
      if (view === 'main') return;
      const template = document.getElementById(`partial-${view}`);
      const slot = document.getElementById(`slot-${view}`);
      if (template && slot) {
        slot.innerHTML = '';
        slot.appendChild(template.content.cloneNode(true));
        slot.style.display = 'block';
        if (view === 'admin') checkAdminSession();
        if (view === 'booking') {
          const today = new Date().toISOString().split('T')[0];
          document.getElementById('bookingTanggal').value = today;
          document.getElementById('bookingTanggal').min = today;
          document.getElementById('bookingMulai').value = '08:00';
          document.getElementById('bookingSelesai').value = '10:00';
        }
      }
      window.scrollTo(0, 0);
    }

    // ========== BOOKING ==========
    function validateBooking() {
      const tanggal = document.getElementById('bookingTanggal').value;
      const sarana = document.getElementById('bookingSarana').value;
      const mulai = document.getElementById('bookingMulai').value;
      const selesai = document.getElementById('bookingSelesai').value;
      const date = new Date(tanggal);
      const day = date.getDay();
      if (day === 5) {
        if (sarana.includes("Aula SMP") || sarana.includes("Serbaguna")) {
          return { valid: false, message: "âŒ Aula SMP & Serbaguna tutup Jum'at" };
        }
        if (mulai < "10:30" || selesai > "13:00") {
          return { valid: false, message: "â° Jum'at: hanya 10.30â€“13.00" };
        }
      }
      if (mulai < "07:30" || selesai > "16:00") {
        return { valid: false, message: "â° Waktu: 07.30â€“16.00 (non-Jum'at)" };
      }
      if (mulai >= selesai) {
        return { valid: false, message: "âŒ Waktu selesai > mulai" };
      }
      return { valid: true };
    }

    function submitBooking() {
      const wa = document.getElementById('bookingWA').value.replace(/[^0-9]/g, '');
      if (wa.length < 10 || wa.length > 13) {
        alert('âŒ Nomor WA tidak valid');
        return;
      }
      const valid = validateBooking();
      if (!valid.valid) {
        alert(valid.message);
        return;
      }
      const data = {
        nama: document.getElementById('bookingNama').value.trim(),
        divisi: document.getElementById('bookingDivisi').value,
        whatsapp: wa,
        sarana: document.getElementById('bookingSarana').value,
        tanggal: document.getElementById('bookingTanggal').value,
        waktu_mulai: document.getElementById('bookingMulai').value,
        waktu_selesai: document.getElementById('bookingSelesai').value,
        keterangan: document.getElementById('bookingKeterangan').value.trim(),
        created_at: new Date().toISOString()
      };
      const msg = `
ğŸ“… *BOOKING - SIF AL FIKRI*
ğŸ‘¤ ${data.nama} (${data.divisi})
ğŸ“ ${data.whatsapp}
ğŸ›ï¸ ${data.sarana}
ğŸ“… ${new Date(data.tanggal).toLocaleDateString('id-ID')}
â° ${data.waktu_mulai}-${data.waktu_selesai}
ğŸ“ ${data.keterangan}
ğŸŒ¿ Dream OS v4.3.3
      `.trim();
      const url = `https://wa.me/${CONFIG.WA_PAK_ERWIN}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
      const bookings = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.BOOKINGS) || '[]');
      bookings.push(data);
      localStorage.setItem(CONFIG.STORAGE_KEYS.BOOKINGS, JSON.stringify(bookings));
      alert('âœ… Booking terkirim!');
      switchView('main');
    }

    // ========== K3 ==========
    function submitK3() {
      const data = {
        jenis: document.getElementById('k3Jenis').value,
        lokasi: document.getElementById('k3Lokasi').value.trim(),
        barang: document.getElementById('k3Barang').value.trim(),
        deskripsi: document.getElementById('k3Deskripsi').value.trim(),
        created_at: new Date().toISOString()
      };
      if (!data.jenis || !data.lokasi || !data.barang || !data.deskripsi) {
        alert('âŒ Semua kolom wajib diisi');
        return;
      }
      const team = data.jenis === 'Kehilangan' ? 'Security' : 
                  data.jenis === 'Kebersihan' ? 'Cleaning Service' : 'Maintenance';
      const msg = `
âš ï¸ *LAPORAN K3 - ${team.toUpperCase()}*
ğŸ“ ${data.lokasi}
ğŸ› ï¸ ${data.barang}
ğŸ“ ${data.deskripsi}
ğŸŒ¿ Dream OS v4.3.3
      `.trim();
      const url = `https://wa.me/${CONFIG.WA_PAK_ERWIN}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
      const reports = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.K3_REPORTS) || '[]');
      reports.push(data);
      localStorage.setItem(CONFIG.STORAGE_KEYS.K3_REPORTS, JSON.stringify(reports));
      alert('âœ… Laporan terkirim!');
      switchView('main');
    }

    // ========== ADMIN ==========
    function checkAdminSession() {
      const session = localStorage.getItem(CONFIG.STORAGE_KEYS.ADMIN_SESSION);
      if (session && Date.now() - parseInt(session) < 3600000) {
        showAdminContent();
      }
    }
    function loginAdmin() {
      const email = document.getElementById('adminEmail').value.trim().toLowerCase();
      if (email === CONFIG.ADMIN_EMAIL) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.ADMIN_SESSION, Date.now().toString());
        showAdminContent();
      } else {
        alert('âŒ Email tidak valid');
      }
    }
    function showAdminContent() {
      document.getElementById('adminLoginForm').style.display = 'none';
      document.getElementById('adminContent').classList.remove('hidden');
      setupTabs();
      loadStats();
      loadInventaris();
    }
    function logoutAdmin() {
      localStorage.removeItem(CONFIG.STORAGE_KEYS.ADMIN_SESSION);
      switchView('main');
    }

    // ========== TABS ==========
    function setupTabs() {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.onclick = () => {
          document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          btn.classList.add('active');
          const tabId = btn.getAttribute('data-tab');
          document.getElementById(`${tabId}-tab`).classList.add('active');
          if (tabId === 'inventaris') loadInventaris();
        };
      });
    }

    // ========== INVENTARIS ==========
    function showAddItemModal() {
      document.getElementById('addItemModal').classList.remove('hidden');
      document.getElementById('invTanggal').value = new Date().toISOString().split('T')[0];
    }
    function hideAddItemModal() {
      document.getElementById('addItemModal').classList.add('hidden');
    }
    function saveInventarisItem() {
      const item = {
        id: Date.now(),
        kode: document.getElementById('invKode').value.trim(),
        nama: document.getElementById('invNama').value.trim(),
        kategori: document.getElementById('invKategori').value,
        jumlah: parseInt(document.getElementById('invJumlah').value),
        kondisi: document.getElementById('invKondisi').value,
        lokasi: document.getElementById('invLokasi').value.trim(),
        tanggal: document.getElementById('invTanggal').value,
        keterangan: document.getElementById('invKeterangan').value.trim(),
        createdAt: new Date().toISOString()
      };
      if (!item.kode || !item.nama || !item.kategori || !item.lokasi || !item.tanggal || item.jumlah < 1) {
        alert('âŒ Lengkapi data dengan benar');
        return;
      }
      const inv = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.INVENTARIS) || '[]');
      inv.push(item);
      localStorage.setItem(CONFIG.STORAGE_KEYS.INVENTARIS, JSON.stringify(inv));
      hideAddItemModal();
      loadInventaris();
      loadStats();
      alert('âœ… Barang ditambahkan!');
    }
    function loadInventaris() {
      const inv = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.INVENTARIS) || '[]');
      const tbody = document.getElementById('inventaris-table-body');
      const empty = document.getElementById('inventaris-empty');
      if (!tbody || !empty) return;
      if (inv.length === 0) {
        tbody.innerHTML = '';
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';
      inv.sort((a, b) => b.id - a.id);
      tbody.innerHTML = inv.map(i => {
        const cls = i.kondisi === 'Baik' ? 'status-good' : 
                    i.kondisi === 'Rusak' ? 'status-danger' : 'status-warning';
        return `
          <tr>
            <td><strong>${i.kode}</strong></td>
            <td>${i.nama}</td>
            <td>${i.kategori}</td>
            <td>${i.jumlah}</td>
            <td><span class="status-badge ${cls}">${i.kondisi}</span></td>
            <td>${i.lokasi}</td>
            <td>
              <button class="btn-small btn-secondary" onclick="alert('Fitur edit: hapus & tambah ulang')">âœï¸</button>
              <button class="btn-small btn-danger" onclick="deleteItem(${i.id})">ğŸ—‘ï¸</button>
            </td>
          </tr>
        `;
      }).join('');
    }
    function deleteItem(id) {
      if (!confirm('âš ï¸ Hapus barang ini?')) return;
      const inv = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.INVENTARIS) || '[]');
      const newInv = inv.filter(i => i.id !== id);
      localStorage.setItem(CONFIG.STORAGE_KEYS.INVENTARIS, JSON.stringify(newInv));
      loadInventaris();
      loadStats();
      alert('âœ… Dihapus!');
    }
    function loadStats() {
      document.getElementById('statsBookingCount').textContent = 
        JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.BOOKINGS) || '[]').length;
      document.getElementById('statsK3Count').textContent = 
        JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.K3_REPORTS) || '[]').length;
      document.getElementById('statsInventarisCount').textContent = 
        JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.INVENTARIS) || '[]').length;
    }

    // ========== EXPORT ==========
    function exportData() {
      const data = {
        exportedAt: new Date().toISOString(),
        bookings: JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.BOOKINGS) || '[]'),
        k3: JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.K3_REPORTS) || '[]'),
        inventaris: JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.INVENTARIS) || '[]')
      };
      const str = JSON.stringify(data, null, 2);
      const uri = 'data:application/json;charset=utf-8,' + encodeURIComponent(str);
      const a = document.createElement('a');
      a.href = uri;
      a.download = `dream-os-backup-${new Date().toISOString().slice(0,10)}.json`;
      a.click();
      alert('âœ… Data diunduh!');
    }

    // ========== INIT ==========
    document.addEventListener('DOMContentLoaded', () => {
      switchView('main');
      const today = new Date().toISOString().split('T')[0];
      document.querySelectorAll('input[type="date"]').forEach(el => {
        if (!el.value) el.value = today;
      });
    });
  </script>
</body>
</html>
